{% extends "base.html" %}

{% block content %}
<div class="flex gap-6">
    <!-- Sidebar / Filters -->
<aside class="w-64 p-6 h-fit bg-white shadow-lg rounded-xl space-y-8 border border-gray-200">

  <!-- Apply Button -->
  <div class="w-full bg-indigo-600 text-center text-white py-2 rounded-md hover:bg-indigo-700 transition-colors font-semibold">
    Instant Filters
  </div>
  <!-- Categories -->
  <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
    <h3 class="font-semibold mb-3 text-gray-700 text-lg border-b border-gray-200 pb-2">Categories</h3>
    {% for c in categories %}
      <label class="flex items-center gap-3 mb-2 cursor-pointer hover:bg-indigo-50 p-1 rounded">
        <input type="checkbox" name="category" value="{{ c.id }}" class="filter-checkbox accent-indigo-600">
        <span class="text-gray-800 font-medium">{{ c.name }}</span>
      </label>
    {% endfor %}
  </div>

  <!-- Brands Dropdown -->
<div class="bg-gray-50 p-4 rounded-lg shadow-sm">
  <h3 class="font-semibold mb-3 text-gray-700 text-lg border-b border-gray-200 pb-2">Brands</h3>
  <select name="brand" class="w-full p-2 border border-gray-300 rounded-md bg-white text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500">
    <option value="">-- All Brands --</option>
    {% for brand in brands %}
      <option value="{{ brand.id }}" {% if request.GET.brand == brand.id|stringformat:"s" %}selected{% endif %}>
        {{ brand.name }}
      </option>
    {% endfor %}
  </select>
</div>


  <!-- Status -->
  <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
    <h3 class="font-semibold mb-3 text-gray-700 text-lg border-b border-gray-200 pb-2">Status</h3>
    {% for s in statuses %}
      <label class="flex items-center gap-3 mb-2 cursor-pointer hover:bg-indigo-50 p-1 rounded">
        <input type="checkbox" name="status" value="{{ s.0 }}" class="filter-checkbox accent-indigo-600">
        <span class="text-gray-800 font-medium">{{ s.1 }}</span>
      </label>
    {% endfor %}
  </div>

  <!-- Price Dropdown -->
  <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
    <h3 class="font-semibold mb-3 text-gray-700 text-lg border-b border-gray-200 pb-2">Price</h3>
    <select name="price_bucket" class="w-full p-2 border border-gray-300 rounded-md bg-white text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-500">
      <option value="">-- All Prices --</option>
      <option value="0_50">Under $50</option>
      <option value="50_100">$50–$100</option>
      <option value="100_200">$100–$200</option>
      <option value="200_500">$200–$500</option>
      <option value="500_800">$500–$800</option>
      <option value="800_1000">$800–$1000</option>
    </select>
  </div>
</aside>

  <!-- Product List -->
  <main class="flex-1 p-4">
    <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
      {% include "products/partials/filter_instant_list.html" %}
    </div>
  </main>
</div>
<!-- Pagination -->
    {% if page_obj.has_other_pages %}
    <div class="flex justify-center mt-6 space-x-2">

        <!-- Previous -->
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
            class="px-3 py-1 border rounded bg-gray-200 hover:bg-gray-300 transition">Previous</a>
        {% endif %}

        <!-- Page Numbers (current ±2) -->
        {% for num in page_obj.paginator.page_range %}
        {% if num >= page_obj.number|add:"-2" and num <= page_obj.number|add:"2" %} {% if num == page_obj.number %} <span
            class="px-3 py-1 border rounded bg-blue-600 text-white">{{ num }}</span>
            {% else %}
            <a href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
                class="px-3 py-1 border rounded bg-gray-200 hover:bg-gray-300 transition">{{ num }}</a>
            {% endif %}
            {% endif %}
            {% endfor %}

            <!-- Next -->
            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
                class="px-3 py-1 border rounded bg-gray-200 hover:bg-gray-300 transition">Next</a>
            {% endif %}

    </div>
    {% endif %}

<!-- Optional JS for instant filtering -->
<script>
document.querySelectorAll(
  '.filter-checkbox, select[name="price_bucket"], select[name="brand"]'
).forEach(el => {
    el.addEventListener('change', () => {
        const formData = new FormData();

        // checkboxes
        document.querySelectorAll('.filter-checkbox:checked').forEach(cb => {
            formData.append(cb.name, cb.value);
        });

        // price
        const price = document.querySelector('select[name="price_bucket"]').value;
        if (price) formData.append('price_bucket', price);

        // brand
        const brand = document.querySelector('select[name="brand"]').value;
        if (brand) formData.append('brand', brand);

        // Fetch AJAX
        fetch('/instant_filter/?' + new URLSearchParams(formData), {
            headers: { 'X-Requested-With': 'XMLHttpRequest' }
        })
        .then(res => res.json())
        .then(data => {
            document.getElementById('product-list').innerHTML = data.html;
        });
    });
});
</script>

{% endblock content %}